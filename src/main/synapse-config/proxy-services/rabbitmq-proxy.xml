<proxy xmlns="http://ws.apache.org/ns/synapse" name="rabbitmq-proxy" transports="rabbitmq" statistics="disable" trace="disable" startOnLoad="true">
   <target>
      <inSequence>
         <log level="custom">
			<property name="rabbitmq-proxy" value="inSequence"/>
		 </log>
		 <log level="custom">
			<property name="rabbitmq-proxy" expression="concat('content=',$body//test/text())"/>
		 </log>
		 <script language="js"> try{ java.lang.Thread.sleep(2000); }catch(e){}</script>
         <property name="OUT_ONLY" value="true"/>
		 <filter xpath="$body//test/text()='error'">
			<then>		 
				<script language="js">java.lang.Thread.sleep(mc.getProperty("WaitTime"))</script>
			</then>
		</filter>
		<drop/>
      </inSequence>
	  <faultSequence>
		<log level="custom">
				<property name="rabbitmq-proxy" value="faultSequence" />
				<property name="ERROR_CODE" expression="$ctx:ERROR_CODE"/>
				<property name="ERROR_MESSAGE" expression="$ctx:ERROR_MESSAGE"/>
			</log>
			<property name="SET_ROLLBACK_ONLY" value="false" scope="axis2" />
			<property name="SET_REQUEUE_ON_ROLLBACK" value="true" scope="axis2" type="STRING"/>
	  </faultSequence>
   </target>
   <parameter name="rabbitmq.queue.name">queue1</parameter>
   <parameter name="rabbitmq.cache.level">1</parameter>
   <parameter name="rabbitmq.channel.consumer.qos">1</parameter>
   <parameter name="rabbitmq.exchange.name">exchange1</parameter>
   <parameter name="rabbitmq.connection.factory">AMQPConnectionFactory</parameter>
   <description></description>
</proxy>